(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/common/goods-detail"],{1177:function(t,o,e){"use strict";var n,i=function(){var t=this,o=t.$createElement;t._self._c},a=[];e.d(o,"b",(function(){return i})),e.d(o,"c",(function(){return a})),e.d(o,"a",(function(){return n}))},"2b95":function(t,o,e){"use strict";(function(t,n){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i,a=c(e("a34a")),s=e("8c24");e("61d4");function c(t){return t&&t.__esModule?t:{default:t}}function l(t,o,e){return o in t?Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[o]=e,t}function r(t,o){return g(t)||d(t,o)||u()}function u(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function d(t,o){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var e=[],n=!0,i=!1,a=void 0;try{for(var s,c=t[Symbol.iterator]();!(n=(s=c.next()).done);n=!0)if(e.push(s.value),o&&e.length===o)break}catch(l){i=!0,a=l}finally{try{n||null==c["return"]||c["return"]()}finally{if(i)throw a}}return e}}function g(t){if(Array.isArray(t))return t}function h(t,o,e,n,i,a,s){try{var c=t[a](s),l=c.value}catch(r){return void e(r)}c.done?o(l):Promise.resolve(l).then(n,i)}function f(t){return function(){var o=this,e=arguments;return new Promise((function(n,i){var a=t.apply(o,e);function s(t){h(a,n,i,s,c,"next",t)}function c(t){h(a,n,i,s,c,"throw",t)}s(void 0)}))}}var m=function(){e.e("components/uni-icon").then(function(){return resolve(e("96b7"))}.bind(null,e)).catch(e.oe)},p=function(){e.e("components/product-list").then(function(){return resolve(e("c398"))}.bind(null,e)).catch(e.oe)},v=function(){e.e("components/other/uni-collapse/uni-collapse").then(function(){return resolve(e("be22"))}.bind(null,e)).catch(e.oe)},_=function(){e.e("components/other/uni-collapse-item/uni-collapse-item").then(function(){return resolve(e("6bb1"))}.bind(null,e)).catch(e.oe)},y=function(){e.e("components/other/uni-list/uni-list").then(function(){return resolve(e("165d"))}.bind(null,e)).catch(e.oe)},b=function(){e.e("components/other/uni-list-item/uni-list-item").then(function(){return resolve(e("849c"))}.bind(null,e)).catch(e.oe)},w=function(){e.e("components/uni-popup").then(function(){return resolve(e("7594"))}.bind(null,e)).catch(e.oe)},S=(i={props:{isSE:{type:Boolean,default:!1},presale:String},computed:{qhj:function(){var t=0;return t=this.good.item_info.zk_final_price-this.good.youhuiquan>0?(this.good.item_info.zk_final_price-this.good.youhuiquan).toFixed(2):this.good.item_info.zk_final_price,t}},components:{productList:p,uniCollapse:v,uniCollapseItem:_,uniList:y,uniListItem:b,uniPopup:w,uniIcon:m},data:function(){return{pt:"",type:"",bottomData:[{text:"微信好友",icon:"",name:"wx"},{text:"朋友圈",icon:"",name:"wx"},{text:"发圈",icon:"",name:"fq"}],nowScrollTop:0,isCollection:!1,collentionColor:"#fff",table:"",page:1,id:"",scrolltop:0,navisShow:!0,isactive:!0,reprice:15,copykey:"",url:"",good:null,detailImgs:[],goodObj:{small_images:null,zk_final_price:null,reserve_price:null,volume:null,title:"",short_url:"",item_description:"",jy:null,pict_url:"",num_iid:"",item_url:""},recommend:{},detail:null,phone:this.getUser(),webview:t.getStorageSync("webview"),pageType:""}},onLoad:function(o){n("log",o," at pages\\common\\goods-detail.vue:278");var e=o.id||"";this.pt=o.pt,this.id=Number(e);o.table;var i=o.page||"";this.isSE=o.isSE||!1,this.presale=o.presale,this.page=i,this.pageType=o.pageType||"",n("log",o.isSE," at pages\\common\\goods-detail.vue:288");this._getPid();this._getData(this.id),t.setStorageSync("webview",!1),this.loadTBKgoodsInfo(this.id)},onBackPress:function(o){n("log",JSON.stringify(o)," at pages\\common\\goods-detail.vue:295"),t.switchTab({url:"/pages/index/index"})},onShow:function(){this.existUser()}},l(i,"onBackPress",(function(o){n("log",o," at pages\\common\\goods-detail.vue:304"),"backbutton"==o.from&&"send_circle"==this.pageType&&t.switchTab({url:"/pages/send_circle/index"})})),l(i,"methods",{loadTBKgoodsInfo:function(){var o=f(a.default.mark((function o(e){var i,s,c,l,u,d,g,h,f,m;return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return(new Date).getTime(),o.next=3,t.request({url:"https://h5api.m.taobao.com/h5/mtop.taobao.detail.getdesc/6.0",method:"GET",header:{"content-type":"application/json;charset=UTF-8  "},data:{data:'{"id":"'+e+'"}',_:(new Date).getTime()}});case 3:if(i=o.sent,s=r(i,2),s[0],c=s[1],200==c.statusCode){for(l=c.data.data.pcDescContent||{},u=l.match(/<img.*?(?:>|\/>)/gi),d=/src=[\'\"]?([^\'\"]*)[\'\"]?/i,g=[],h=1;h<u.length;h++)f=u[h].match(d),f[1]&&(m=f[1],"http://"==m.substr(0,7).toLowerCase()&&"https://"==m.substr(0,8).toLowerCase()||(m="http://"+m),g.push(m));n("log","loadTBKgoodsInfo==>获取商品详情",g," at pages\\common\\goods-detail.vue:347"),g.length>0&&(this.detailImgs=g,n("log",e," at pages\\common\\goods-detail.vue:350"),n("log",this.detailImgs," at pages\\common\\goods-detail.vue:351"))}case 8:case"end":return o.stop()}}),o,this)})));function e(t){return o.apply(this,arguments)}return e}(),togglePopup:function(t){this.type=t},_getPid:function(){try{var o=t.getStorageSync("user");return o.pid}catch(e){}},getUser:function(){try{var o=t.getStorageSync("user");return o.phone}catch(e){n("log",e," at pages\\common\\goods-detail.vue:372")}},getRelationId:function(){n("log",JSON.stringify(t.getStorageSync("user"))," at pages\\common\\goods-detail.vue:376");try{return t.getStorageSync("user").pid}catch(o){n("log",o," at pages\\common\\goods-detail.vue:380")}},getPhone:function(){try{return t.getStorageSync("user").phone}catch(o){n("log",o," at pages\\common\\goods-detail.vue:387")}},copyTpwd:function(o){"tkl"==o?t.setClipboardData({data:this.good.tpwd,success:function(){t.showToast({title:"已复制"})}}):"link"==o?t.setClipboardData({data:this.good.tpwd,success:function(){t.showToast({title:"已复制"})}}):"title"==o&&t.setClipboardData({data:this.good.item_info.title,success:function(){t.showToast({title:"已复制"})}})},collection:function(){var o=this;this.phone?this.isCollection?(n("log","取消收藏",this.isCollection," at pages\\common\\goods-detail.vue:431"),this.collentionColor="#fff",(0,s.deleteCollection)({phone:this.phone,num_iid:this.good.num_iid}).then((function(e){o.isCollection=!1,t.showToast({title:"已取消"})}))):this.isCollection||(n("log","增加收藏",this.isCollection," at pages\\common\\goods-detail.vue:443"),this.collentionColor="#ff0000",(0,s.addCollection)({phone:this.phone,volume:this.good.item_info.volume,quanhoujia:this.good.item_info.reserve_price,youhuiquan:this.good.youhuiquan||0,zk_final_price:this.good.item_info.zk_final_price,title:this.good.item_info.title,pict_url:this.good.item_info.pict_url,num_iid:this.id}).then((function(e){n("log",e," at pages\\common\\goods-detail.vue:457"),n("log","已收藏"," at pages\\common\\goods-detail.vue:458"),o.isCollection=!0,t.showToast({title:"已收藏"})}))):t.showToast({title:"未登录",icon:"none"})},share:function(o){var e=this;if(this.phone){n("log",JSON.stringify(this.good)," at pages\\common\\goods-detail.vue:475"),n("log",JSON.stringify(this.good.small_images)," at pages\\common\\goods-detail.vue:476"),n("log",this.good.small_images," at pages\\common\\goods-detail.vue:477"),t.setStorageSync("webview",!0);var i=this.good.tpwd.substr(1,this.good.tpwd.length-2),a="http://51atk.com:8009/html/openInstall/?invitecode="+t.getStorageSync("invitecode")+"&tkl="+i+"&short_url="+this.good.short_url;n("log",i," at pages\\common\\goods-detail.vue:482"),(0,s.getShareImgUrl)({url:this.good.item_info.pict_url,CodeContent:a,TitleContent:this.good.item_info.title,NowPrice:this.good.item_info.zk_final_price,OldPrice:this.good.item_info.reserve_price,RedecePrice:this.good.youhuiquan,InvitationCode:t.getStorageSync("invitecode")}).then((function(o){n("log",JSON.stringify(o)," at pages\\common\\goods-detail.vue:498"),e.url="http://39.108.215.49:8009/html/getShareImgUrl.html?url="+e.goodObj.pict_url+"&CodeContent="+a+"&TitleContent="+e.goodObj.title+"&NowPrice="+e.goodObj.zk_final_price+"&OldPrice="+e.goodObj.reserve_price+"&RedecePrice="+e.good.youhuiquan+"&InvitationCode="+t.getStorageSync("invitecode")+"&title="+e.goodObj.title+"&zk_final_price="+e.goodObj.zk_final_price+"&reserve_price="+e.goodObj.reserve_price+"&item_url="+e.goodObj.item_url+"&copykey="+e.copykey+"&yj1="+e.goodObj.yj,e.copykey="復制这段描述₳".concat(e.good.tpwd.substr(1,11),"₳,\n进入【Tao宝】即可抢购"),n("log",e.url," at pages\\common\\goods-detail.vue:511"),t.navigateTo({url:"share?id=".concat(e.id,"&pict_url=").concat(e.good.item_info.pict_url,"&youhuiquan=").concat(e.good.youhuiquan,"&yj=").concat(e.good.yj,"&title=").concat(e.good.item_info.title,"&zk_final_price=").concat(e.good.item_info.zk_final_price,"&reserve_price=").concat(e.good.item_info.reserve_price,"&small_images=").concat(e.good.small_images,"&copykey=").concat(e.copykey,"&short_url=").concat(e.good.short_url,"&invitecode=").concat(t.getStorageSync("invitecode"),"&imgUrl=").concat(o.imgUrl,"&item_url=").concat(e.good.item_url,"&description=").concat(e.good.item_info.cat_leaf_name)})}))}else t.showToast({title:"未登录",icon:"none"})},existUser:function(){var o=this;(0,s.existUser)(this.phone).then((function(e){200!=e.data.code&&(t.showToast({title:"未登录!",icon:"none"}),o.phone=null)}))},jump:function(o){if(this.phone){n("log",o," at pages\\common\\goods-detail.vue:549");var e=o.slice(8);n("log","taobao://".concat(e)," at pages\\common\\goods-detail.vue:551"),plus.runtime.openURL("taobao://".concat(e)),n("log","url:"+o," at pages\\common\\goods-detail.vue:553")}else t.showToast({title:"未登录",icon:"none"})},recod:function(){var t=this;(0,s.getItemsDes)(this.id).then((function(o){n("log",t.id," at pages\\common\\goods-detail.vue:557")}))},getDetailImgs:function(){var o=f(a.default.mark((function o(e){return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise((function(o,i){t.request({url:e,success:function(t){n("log",JSON.stringify(t.data.data.pcDescContent)," at pages\\common\\goods-detail.vue:566"),o(t.data)},fail:function(t){n("log",t," at pages\\common\\goods-detail.vue:570")}})})));case 1:case"end":return o.stop()}}),o)})));function e(t){return o.apply(this,arguments)}return e}(),regexpDetail:function(t){if(200==res.statusCode){for(var o=res.data.data.pcDescContent||{},e=o.match(/<img.*?(?:>|\/>)/gi),n=/src=[\'\"]?([^\'\"]*)[\'\"]?/i,i=[],a=1;a<e.length;a++){var s=e[a].match(n);if(s[1]){var c=s[1];"http://"==c.substr(0,7).toLowerCase()&&"https://"==c.substr(0,8).toLowerCase()||(c="http://"+c),i.push(c)}}i.length>0&&(this.detailImgs=i)}},_getData:function(o){var e=this;n("log",this.getPhone()," at pages\\common\\goods-detail.vue:615"),this.phone||t.showToast({title:"未登录",icon:"none"}),t.showLoading({title:"正在玩命加载..."}),n("log",Number(this.getRelationId())," at pages\\common\\goods-detail.vue:625"),o=Number(o),n("log",typeof o," at pages\\common\\goods-detail.vue:627"),n("log",o," at pages\\common\\goods-detail.vue:628");var i=Promise.all([(0,s.getGoodDetail)(o,Number(this.getRelationId())),(0,s.getMaterialItem)(o)]);i.then((function(o){e.good={},o.length>0&&(n("log","商品详情1"," at pages\\common\\goods-detail.vue:638"),n("log",JSON.stringify(o[1])," at pages\\common\\goods-detail.vue:639"),200!=o[0].code&&(t.showToast({title:o[0].msg,icon:"none"}),setTimeout((function(){t.navigateBack({delta:1})}),3e3)),e.good=o[0].data,e.good.small_images=o[0].data.item_info.small_images.string,e.good.yj=(e.qhj*(e.good.max_commission_rate/100)*.4).toFixed(2),e.recommend=o[1].result)})),setTimeout((function(){t.hideLoading()}),1e3)},_getDetailImg:function(t){for(var o="",e=/<[^>]*>|<\/[^>]*>/gm,n=t.length,i=0;i<n;i++)-1!=t[i].indexOf("<txt>")?o+="":o+="<img src='https://"+t[i].replace(e,"")+"' style='width:100%;max-width:100%' />";return o},_getGoodDetail:function(o,e){var i=this,a=(0,s.getGoodDetail)(o,e);t.showLoading({title:"加载中...",mask:!0}),a.then((function(o){t.hideLoading(),200==o.code?(i.good=o.result,n("log","sp",i.good," at pages\\common\\goods-detail.vue:685")):t.showToast({title:"查无此商品",icon:"none"})})),setTimeout((function(){t.hideLoading()}),1e3)},_getRecommend:function(){var t=this,o=(0,s.getGoodsList)({page:0,type:"",screen:"",jg:""});o.then((function(o){200==o.code&&(t.recommend=o.result)}))},back:function(){t.navigateBack({delta:1})},_onscroll:function(t){var o=t.target||t.srcElement;this.nowScrollTop=o.scrollTop},go:function(t){t||window.event;var o=t.target||t.srcElement;o.offsetLeft<190&&o.offsetLeft>150?(this.scrolltop=this.nowScrollTop,this.$nextTick((function(){this.scrolltop=0,this.isactive=!0}))):o.offsetLeft<240&&o.offsetLeft>190&&(n("log","2",this.scrolltop," at pages\\common\\goods-detail.vue:738"),this.scrolltop=this.nowScrollTop,this.$nextTick((function(){this.scrolltop=555,this.isactive=!1})))}}),i);o.default=S}).call(this,e("6e42")["default"],e("0de9")["default"])},4046:function(t,o,e){},"4faf":function(t,o,e){"use strict";(function(t){e("00a9"),e("921b");n(e("66fd"));var o=n(e("747f"));function n(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,e("6e42")["createPage"])},"747f":function(t,o,e){"use strict";e.r(o);var n=e("1177"),i=e("ad59");for(var a in i)"default"!==a&&function(t){e.d(o,t,(function(){return i[t]}))}(a);e("c1af");var s,c=e("f0c5"),l=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,"1e86ccf4",null,!1,n["a"],s);o["default"]=l.exports},ad59:function(t,o,e){"use strict";e.r(o);var n=e("2b95"),i=e.n(n);for(var a in n)"default"!==a&&function(t){e.d(o,t,(function(){return n[t]}))}(a);o["default"]=i.a},c1af:function(t,o,e){"use strict";var n=e("4046"),i=e.n(n);i.a}},[["4faf","common/runtime","common/vendor"]]]);